<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroAI | Auto-Sense</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <style>
        :root { --primary: #00ff88; --bg: #0b0f14; --glass: rgba(22, 27, 34, 0.85); }
        body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: white; overflow: hidden; }

        /* Full Screen Camera */
        .viewport { position: relative; width: 100vw; height: 100vh; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        /* HUD / UI Overlay */
        .hud {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; z-index: 10;
        }

        .glass-panel {
            background: var(--glass); backdrop-filter: blur(20px);
            padding: 25px; border-radius: 32px; border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.8); text-align: center;
        }

        .scanning-text {
            font-size: 0.7rem; letter-spacing: 3px; color: var(--primary);
            font-weight: 900; text-transform: uppercase; margin-bottom: 5px;
            animation: blink 1.5s infinite;
        }

        @keyframes blink { 50% { opacity: 0.3; } }

        #soil-output { 
            font-size: 2.5rem; font-weight: 900; margin: 0; 
            text-transform: capitalize; transition: 0.2s;
            background: linear-gradient(to bottom, #fff, #888);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .crop-container { 
            display: flex; flex-wrap: wrap; justify-content: center; 
            gap: 10px; margin-top: 20px; min-height: 40px;
        }

        .crop-badge {
            background: rgba(0, 255, 136, 0.1); border: 1px solid var(--primary);
            color: var(--primary); padding: 8px 16px; border-radius: 12px;
            font-size: 0.85rem; font-weight: 700; animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Top Scanning Line */
        .scanner-bar {
            position: absolute; top: 0; width: 100%; height: 2px;
            background: var(--primary); box-shadow: 0 0 15px var(--primary);
            animation: sweep 3s ease-in-out infinite; z-index: 5;
        }

        @keyframes sweep { 0%, 100% { top: 10%; } 50% { top: 90%; } }
    </style>
</head>
<body>

<div class="viewport">
    <video id="webcam" autoplay playsinline></video>
    <div class="scanner-bar"></div>
    
    <div class="hud">
        <div class="glass-panel">
            <div class="scanning-text" id="status">AI Live Analyzing</div>
            <h1 id="soil-output">Scanning...</h1>
            <div id="crop-output" class="crop-container"></div>
        </div>
    </div>
</div>

<script>
    const video = document.getElementById('webcam');
    const soilLabel = document.getElementById('soil-output');
    const cropContainer = document.getElementById('crop-output');
    let lastDetected = "";

    const cropRules = {
        laterite: ["Cashew", "Coffee", "Tea"],
        red: ["Cotton", "Wheat", "Maize"],
        alluvial: ["Rice", "Wheat", "Sugarcane"],
        black: ["Cotton", "Soybean", "Tobacco"],
        arid: ["Bajra", "Millets", "Guar"],
        mountain: ["Apple", "Barley", "Potato"]
    };

    async function startApp() {
        // Init Camera
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        video.srcObject = stream;

        // AI Loop (Simulated for Pure HTML Speed)
        function autoAnalyze() {
            // In your real version, this is where the TFJS model output goes
            // We simulate a confidence-based auto-lock
            const soils = Object.keys(cropRules);
            const detected = soils[Math.floor(Math.random() * soils.length)]; 

            if (detected !== lastDetected) {
                lastDetected = detected;
                updateUI(detected);
            }
            
            // Re-runs every 3 seconds to avoid UI flickering while still being "instant"
            setTimeout(autoAnalyze, 3000); 
        }
        autoAnalyze();
    }

    function updateUI(soil) {
        soilLabel.innerText = soil;
        
        // Clear and update crop badges automatically
        cropContainer.innerHTML = '';
        cropRules[soil].forEach(crop => {
            const span = document.createElement('span');
            span.className = 'crop-badge';
            span.innerText = crop;
            cropContainer.appendChild(span);
        });
    }

    startApp();
</script>
</body>
</html>
