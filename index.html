<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<style>
body {
  margin: 0;
  background: black;
  overflow: hidden;
  font-family: system-ui, sans-serif;
}

/* Camera */
#camera canvas {
  width: 100vw;
  height: 100vh;
  object-fit: cover;
}

/* Lightweight HUD */
#label {
  position: absolute;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  padding: 10px 18px;
  border-radius: 14px;
  background: rgba(0,0,0,0.55);
  color: white;
  font-size: 16px;
  font-weight: 600;
  letter-spacing: 0.04em;
}
</style>
</head>

<body>

<div id="camera"></div>
<div id="label">Loadingâ€¦</div>

<script>
const modelURL = "https://teachablemachine.withgoogle.com/models/YOUR_MODEL_URL_HERE/";

let model, webcam;
let lastSent = "";

async function init() {
  model = await tmImage.load(
    modelURL + "model.json",
    modelURL + "metadata.json"
  );

  // BACK CAMERA
  webcam = new tmImage.Webcam(400, 300, false);
  await webcam.setup();
  await webcam.play();

  document.getElementById("camera").appendChild(webcam.canvas);
  requestAnimationFrame(loop);
}

async function loop() {
  webcam.update();
  await predict();
  setTimeout(() => requestAnimationFrame(loop), 800);
}

async function predict() {
  const preds = await model.predict(webcam.canvas);
  const best = preds.reduce((a,b)=>a.probability>b.probability?a:b);

  document.getElementById("label").innerText = best.className;

  if (window.AppInventor && best.className !== lastSent) {
    window.AppInventor.setWebViewString(best.className);
    lastSent = best.className;
  }
}

init();
</script>

</body>
</html>
