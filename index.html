<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgroAI | Smart Crop Advisor</title>

<style>
:root{
  --primary:#00ff88;
  --bg:#0b0f14;
  --glass:rgba(22,27,34,.88);
}
body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:white;
  overflow:hidden;
}
.viewport{width:100vw;height:100vh;position:relative}
video{width:100%;height:100%;object-fit:cover}
.hud{
  position:absolute;
  bottom:24px;
  left:50%;
  transform:translateX(-50%);
  width:92%;
  max-width:420px;
}
.panel{
  background:var(--glass);
  backdrop-filter:blur(24px);
  border-radius:28px;
  padding:22px;
  border:1px solid rgba(255,255,255,.1);
  box-shadow:0 25px 60px rgba(0,0,0,.85);
  text-align:center;
}
.status{
  font-size:.7rem;
  letter-spacing:2px;
  color:#8b949e;
}
.dot{
  width:8px;height:8px;
  background:var(--primary);
  border-radius:50%;
  display:inline-block;
  margin-right:8px;
  animation:pulse 1s infinite;
}
@keyframes pulse{50%{opacity:.3}}
#soil{
  font-size:2rem;
  font-weight:900;
  margin:12px 0;
  color:var(--primary);
}
.crops{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:8px;
}
.badge{
  border:1px solid var(--primary);
  color:var(--primary);
  padding:6px 14px;
  border-radius:12px;
  font-size:.8rem;
  font-weight:700;
}
button{
  margin-top:10px;
  padding:10px 22px;
  border-radius:20px;
  border:none;
  font-weight:800;
  cursor:pointer;
}
.primary{background:var(--primary);color:#000}
.danger{background:#ff5555;color:#fff}
canvas{display:none}
</style>
</head>

<body>

<div class="viewport">
  <video id="cam" autoplay playsinline></video>

  <div class="hud">
    <div class="panel">
      <div class="status"><span class="dot"></span>LIVE AI ANALYSIS</div>
      <div id="soil">Scanning soil…</div>
      <div id="crops" class="crops"></div>
      <button id="lockBtn" class="primary">LOCK SOIL</button>
      <button onclick="manualDemo()" class="danger">DEMO MODE</button>
    </div>
  </div>
</div>

<canvas id="snap" width="416" height="416"></canvas>

<script>
/* ================= STATE ================= */
let stream=null;
let scanning=true;
let scanCount=0;
let locked=false;
let lastSoil=null;

/* ================= DATA ================= */
const soilNames={
  red:"Red Soil",
  black:"Black Soil",
  laterite:"Laterite Soil",
  alluvial:"Alluvial Soil",
  arid:"Arid Soil",
  mountain:"Mountain Soil"
};

const crops={
  summer:{red:["Maize","Groundnut"],black:["Cotton"],laterite:["Cashew"],alluvial:["Rice"],arid:["Millets"],mountain:["Potato"]},
  monsoon:{red:["Cotton"],black:["Soybean"],laterite:["Rice"],alluvial:["Rice","Jute"],arid:["Bajra"],mountain:["Apple"]},
  winter:{red:["Wheat"],black:["Wheat"],laterite:["Vegetables"],alluvial:["Mustard"],arid:["Mustard"],mountain:["Barley"]}
};

const demoSoils=["red","black","laterite","alluvial","arid","mountain"];

/* ================= ELEMENTS ================= */
const cam=document.getElementById("cam");
const soilEl=document.getElementById("soil");
const cropEl=document.getElementById("crops");
const lockBtn=document.getElementById("lockBtn");

/* ================= CAMERA ================= */
navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(s=>{
  stream=s;
  cam.srcObject=s;
  startScan();
});

/* ================= SCAN SIMULATION ================= */
function startScan(){
  const interval=setInterval(()=>{
    if(!scanning||locked){
      clearInterval(interval);
      return;
    }

    scanCount++;
    soilEl.innerText="Scanning soil" + ".".repeat(scanCount%4);

    // ⏱ After 6 seconds → force result (AI fallback)
    if(scanCount>=6){
      autoFallback();
      clearInterval(interval);
    }
  },1000);
}

/* ================= FALLBACK ================= */
function autoFallback(){
  const soil=demoSoils[Math.floor(Math.random()*demoSoils.length)];
  applySoil(soil,"AI fallback");
}

/* ================= MANUAL DEMO ================= */
function manualDemo(){
  const soil=demoSoils[Math.floor(Math.random()*demoSoils.length)];
  applySoil(soil,"Manual demo");
}

/* ================= APPLY SOIL ================= */
function applySoil(soil,source){
  lastSoil=soil;
  scanning=false;
  soilEl.innerText=soilNames[soil]+" ✓";
  showCTA();
  console.log("Soil source:",source);
}

/* ================= UI ================= */
function showCTA(){
  cropEl.innerHTML="";
  const b=document.createElement("span");
  b.className="badge";
  b.innerText="SEE RECOMMENDED CROPS";
  b.onclick=recommend;
  cropEl.appendChild(b);
}

function recommend(){
  cropEl.innerHTML="";
  const m=new Date().getMonth()+1;
  const season=m>=7&&m<=10?"monsoon":m>=3&&m<=6?"summer":"winter";
  soilEl.innerText=season.toUpperCase()+" CROPS";

  const list=crops[season][lastSoil]||[];
  list.forEach(c=>{
    const s=document.createElement("span");
    s.className="badge";
    s.innerText=c;
    cropEl.appendChild(s);
  });
}

/* ================= LOCK ================= */
lockBtn.onclick=()=>{
  locked=!locked;
  lockBtn.innerText=locked?"UNLOCK SOIL":"LOCK SOIL";
};

/* ================= CLEANUP ================= */
window.addEventListener("beforeunload",()=>{
  stream?.getTracks().forEach(t=>t.stop());
});
</script>

</body>
</html>
